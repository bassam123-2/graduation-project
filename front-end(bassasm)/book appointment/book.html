<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Appointment | Elaji Center</title>
    <link rel="stylesheet" href="book.css">
    <link rel="stylesheet" href="../header.css">
    <link rel="stylesheet" href="../footer.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="../auth-utils.js"></script>
</head>
<body>
<!-- Header -->
<div class="header">
  <div class="header-flex">
    <div class="logo">
      <a href="../home.html" style="display: flex; align-items: center; text-decoration: none;">
                <div style="display: flex; align-items: center; background: transparent; color: #2a5d9f; padding: 10px 20px; border-radius: 8px; font-family: Arial, sans-serif;">
                    <div style="background: #2a5d9f; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; margin-right: 15px;">
                        Dr.<br>MBI
                    </div>
                    <div style="display: flex; flex-direction: column;">
                        <div style="font-size: 18px; font-weight: bold; color: #2a5d9f; line-height: 1;">
                            البقاعي للعلاج الحكمي
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 2px;">
                            AL-BOQAI World for Judgmental therapy
                        </div>
                    </div>
                </div>
      </a>
    </div>
    <ul class="navbar" id="main-navbar">
      <li><a href="../home.html">Home</a></li>
      <li><a href="../success-stories.html">Success Stories</a></li>
      <li class="dropdown">
        <span class="dropdown-trigger">ABOUT US</span>
        <ul class="dropdown-menu">
          <li><a href="../about us/aboutus.html">About us</a></li>
          <li><a href="../about us/boqia cv.html">Boqia cv</a></li>
          <li><a href="../about us/targeted group.html">Targeted People</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span class="dropdown-trigger">Our Services</span>
        <ul class="dropdown-menu">
          <li><a href="../our services/manual therapy.html">Manual Therapy</a></li>
          <li><a href="../our services/physical therapy.html">Physical Therapy</a></li>
          <li><a href="../our services/Rehabilitation Body Engineering for Manual Therapy Sciences.html">Rehabilitation Body Engineering</a></li>
        </ul>
      </li>
      <li><a href="book.html" class="active">Book Appointment</a></li>
      <li><a href="contact us.html">Contact Us</a></li>
      <li><a href="sign in.html" class="signin-link" id="signin-nav-link">Sign In</a></li>
      <li><a href="../patient-dashboard.html" class="dashboard-link" id="dashboard-nav-link" style="display: none;">Dashboard</a></li>
    </ul>
    <div class="header-utils">
      <button id="lang-toggle-btn" class="theme-btn" title="تبديل اللغة / Switch Language">
        <i class="fas fa-language"></i>
      </button>
      <button id="theme-toggle-btn" class="theme-btn">
        <i class="fas fa-moon" id="theme-icon"></i>
      </button>
    </div>
  </div>
</div>

<!-- Main Booking Section -->
<div class="booking-container">
  <form class="booking-form" onsubmit="return validateBookingForm()">
    <h2>Book Your Appointment</h2>
    
    <!-- Guest Option Section -->
    <div class="form-section">
      <h3>Booking Type</h3>
              <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="is-guest" name="is-guest">
            <span>Book as Guest (No account required)</span>
          </label>
          <small style="color: var(--text-light); font-size: 0.85em;">
            Check this if you don't want to create an account. You'll receive a guest ID for future reference.
          </small>
          <div id="guest-status" style="margin-top: 10px; padding: 10px; border-radius: 5px; display: none;">
            <strong>Status:</strong> <span id="guest-status-text"></span>
          </div>
        </div>
        
        <div class="form-group" style="text-align: center; margin-top: 20px;">
          <p style="margin-bottom: 10px; color: var(--text-light);">Already have a guest appointment?</p>
          <a href="../guest-lookup.html" style="color: var(--secondary-color); text-decoration: none; font-weight: 600;">
            <i class="fas fa-search"></i> Lookup Your Appointment
          </a>
        </div>
        
        <div class="form-group" style="text-align: center; margin-top: 10px;">
          <a href="../test-guest.html" style="color: var(--warning-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
            <i class="fas fa-vial"></i> Test Guest System
          </a>
        </div>
    </div>

    <!-- Personal Information Section -->
    <div class="form-section">
      <h3>Personal Information</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="firstname">First Name *</label>
          <input type="text" id="firstname" name="firstname" required>
        </div>
        <div class="form-group">
          <label for="lastname">Last Name *</label>
          <input type="text" id="lastname" name="lastname" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
          <label for="phone">Phone Number *</label>
          <input type="tel" id="phone" name="phone" required>
        </div>
      </div>
      
      <div class="form-group">
        <label for="age">Age *</label>
        <input type="number" id="age" name="age" min="1" max="120" required>
        <small style="color: var(--text-light); font-size: 0.85em;">Please enter your age in years</small>
      </div>
      
      <div class="form-group">
        <label for="gender">Gender *</label>
        <select id="gender" name="gender" required>
          <option value="">Select Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </div>
    </div>

    <!-- Appointment Details Section -->
    <div class="form-section">
      <h3>Appointment Details</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="service-type">Service Type *</label>
          <select id="service-type" name="service-type" required>
            <option value="">Select Service</option>
                       <option value="manual-therapy">Manual Therapy</option>
           <option value="physical-therapy">Physical Therapy</option>
           <option value="rehabilitation">Rehabilitation Body Engineering</option>
           <option value="consultation">General Consultation</option>
           <option value="follow-up">Follow-up Session</option>
           <option value="assessment">Initial Assessment</option>
          </select>
        </div>
        <div class="form-group">
          <label for="therapist">Preferred Therapist</label>
          <select id="therapist" name="therapist">
            <option value="">Any Available</option>
            <option value="dr-boqai">Dr. Boqai</option>
            <option value="dr-mbi">Dr. MBI</option>
            <option value="specialist">Specialist</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="appointment-date">Preferred Date *</label>
          <input type="date" id="appointment-date" name="appointment-date" required>
        </div>
        <div class="form-group">
          <label for="appointment-time">Preferred Time *</label>
          <select id="appointment-time" name="appointment-time" required>
            <option value="">Select Time</option>
            <option value="09:00">9:00 AM</option>
            <option value="10:00">10:00 AM</option>
            <option value="11:00">11:00 AM</option>
            <option value="12:00">12:00 PM</option>
            <option value="14:00">2:00 PM</option>
            <option value="15:00">3:00 PM</option>
            <option value="16:00">4:00 PM</option>
            <option value="17:00">5:00 PM</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label for="urgency">Urgency Level</label>
        <select id="urgency" name="urgency">
          <option value="routine">Routine</option>
          <option value="moderate">Moderate</option>
          <option value="urgent">Urgent</option>
          <option value="emergency">Emergency</option>
        </select>
      </div>
    </div>

    <!-- Medical Information Section -->
    <div class="form-section">
      <h3>Medical Information</h3>
      
      <div class="form-group">
        <label for="symptoms">Describe Your Symptoms *</label>
        <textarea id="symptoms" name="symptoms" rows="4" placeholder="Please describe your symptoms, pain level, and any specific concerns..." required></textarea>
      </div>
      
      <div class="form-group">
        <label for="medical-history">Medical History</label>
        <textarea id="medical-history" name="medical-history" rows="3" placeholder="Any relevant medical conditions, surgeries, or medications..."></textarea>
      </div>
      
      <div class="form-group">
        <label for="previous-treatment">Previous Treatment</label>
        <textarea id="previous-treatment" name="previous-treatment" rows="3" placeholder="Any previous treatments, therapies, or consultations..."></textarea>
      </div>
    </div>

    <!-- Additional Information Section -->
    <div class="form-section">
      <h3>Additional Information</h3>
      
      <div class="form-group">
        <label for="special-requirements">Special Requirements</label>
        <textarea id="special-requirements" name="special-requirements" rows="3" placeholder="Any special accommodations, accessibility needs, or preferences..."></textarea>
      </div>
      
      <div class="form-group">
        <label for="insurance">Insurance Information</label>
        <input type="text" id="insurance" name="insurance" placeholder="Insurance provider and policy number (if applicable)">
      </div>
      
      <div class="form-group">
        <label for="referral">Referral Source</label>
        <select id="referral" name="referral">
          <option value="">Select Referral Source</option>
          <option value="self">Self-referral</option>
          <option value="doctor">Doctor Referral</option>
          <option value="friend">Friend/Family Recommendation</option>
          <option value="online">Online Search</option>
          <option value="other">Other</option>
        </select>
      </div>
    </div>

    <!-- Terms and Submit Section -->
    <div class="form-section">
      <div class="form-group checkbox-group">
        <input type="checkbox" id="terms" name="terms" required>
        <label for="terms">I agree to the terms and conditions and privacy policy *</label>
      </div>
      
      <div class="form-group checkbox-group">
        <input type="checkbox" id="consent" name="consent" required>
        <label for="consent">I consent to receive communications about my appointment *</label>
      </div>
      
      <button type="submit" class="submit-btn">
        <i class="fas fa-calendar-check"></i>
        Book Appointment
      </button>
    </div>
  </form>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="footer-content">
    <div class="footer-section">
      <h3>Quick Links</h3>
      <ul>
        <li><a href="../home.html">Home</a></li>
        <li><a href="../success-stories.html">Success Stories</a></li>
        <li><a href="../about us/aboutus.html">About Us</a></li>
        <li><a href="book.html">Book Appointment</a></li>
        <li><a href="contact us.html">Contact Us</a></li>
        <li><a href="sign in.html">Sign In</a></li>
      </ul>
    </div>
    
    <div class="footer-section">
      <h3>Our Services</h3>
      <ul>
        <li><a href="../our services/manual therapy.html">Manual Therapy</a></li>
        <li><a href="../our services/physical therapy.html">Physical Therapy</a></li>
        <li><a href="../our services/Rehabilitation Body Engineering for Manual Therapy Sciences.html">Rehabilitation Body Engineering</a></li>
      </ul>
    </div>
    
    <div class="footer-section">
      <h3>Contact Information</h3>
      <p><i class="fas fa-phone"></i> +123 456 7890</p>
      <p><i class="fas fa-envelope"></i> info@elajicenter.com</p>
      <p><i class="fas fa-map-marker-alt"></i> 123 Therapy Street, Medical City</p>
    </div>
    
    <div class="footer-section">
      <h3>Follow Us</h3>
      <div class="social-links">
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-linkedin"></i></a>
      </div>
    </div>
  </div>
  
  <div class="footer-bottom">
    <p>&copy; 2024 Elaji Center. All rights reserved.</p>
  </div>
</footer>

    <script>
// Guest checkbox status display
document.getElementById('is-guest').addEventListener('change', function() {
    const statusDiv = document.getElementById('guest-status');
    const statusText = document.getElementById('guest-status-text');
    
    if (this.checked) {
        statusDiv.style.display = 'block';
        statusDiv.style.backgroundColor = '#d4edda';
        statusDiv.style.color = '#155724';
        statusDiv.style.border = '1px solid #c3e6cb';
        statusText.textContent = 'Guest mode enabled - No account will be created';
    } else {
        statusDiv.style.display = 'block';
        statusDiv.style.backgroundColor = '#f8d7da';
        statusDiv.style.color = '#721c24';
        statusDiv.style.border = '1px solid #f5c6cb';
        statusText.textContent = 'Regular mode - Account will be created';
    }
});

// Theme toggle functionality
document.getElementById('theme-toggle-btn').addEventListener('click', function() {
    const body = document.body;
    const icon = document.getElementById('theme-icon');
    
    if (body.getAttribute('data-theme') === 'dark') {
        body.removeAttribute('data-theme');
        icon.className = 'fas fa-moon';
    } else {
        body.setAttribute('data-theme', 'dark');
        icon.className = 'fas fa-sun';
    }
});

// Language toggle functionality
document.getElementById('lang-toggle-btn').addEventListener('click', function() {
    // Language toggle logic can be implemented here
    alert('Language toggle functionality will be implemented here');
});

// Form validation and submission
function validateBookingForm() {
    const requiredFields = document.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.style.borderColor = '#e74c3c';
            isValid = false;
        } else {
            field.style.borderColor = '';
        }
    });
    
    if (!isValid) {
        showNotification('Please fill in all required fields marked with *', 'error');
        return false;
    }
    
    // Additional validation
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const age = document.getElementById('age').value;
    
    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        showNotification('Please enter a valid email address', 'error');
        document.getElementById('email').style.borderColor = '#e74c3c';
        return false;
    }
    
    // Phone validation (basic)
    if (phone.length < 10) {
        showNotification('Please enter a valid phone number', 'error');
        document.getElementById('phone').style.borderColor = '#e74c3c';
        return false;
    }
    
    // Age validation
    if (age < 1 || age > 120) {
        showNotification('Please enter a valid age between 1 and 120', 'error');
        document.getElementById('age').style.borderColor = '#e74c3c';
        return false;
    }
    
    // If validation passes, submit the form
    submitAppointmentForm();
    return false; // Prevent default form submission
}

// Submit appointment form to backend
async function submitAppointmentForm() {
    const submitBtn = document.querySelector('.submit-btn');
    const originalText = submitBtn.innerHTML;
    
    try {
        // Show loading state
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Booking Appointment...';
        submitBtn.disabled = true;
        
        // Collect form data for public booking endpoint
        const formData = {
            // Guest option
            is_guest: document.getElementById('is-guest').checked,
            
            // Required fields for public booking
            firstname: document.getElementById('firstname').value.trim(),
            lastname: document.getElementById('lastname').value.trim(),
            email: document.getElementById('email').value.trim(),
            phone: document.getElementById('phone').value.trim(),
            age: document.getElementById('age').value,
            gender: document.getElementById('gender').value,
            service_type: document.getElementById('service-type').value,
            appointment_date: document.getElementById('appointment-date').value,
            appointment_time: document.getElementById('appointment-time').value,
            symptoms: document.getElementById('symptoms').value.trim(),
            
            // Optional fields
            medical_history: document.getElementById('medical-history').value.trim(),
            previous_treatment: document.getElementById('previous-treatment').value.trim(),
            special_requirements: document.getElementById('special-requirements').value.trim(),
            insurance: document.getElementById('insurance').value.trim(),
            urgency: document.getElementById('urgency').value,
            referral: document.getElementById('referral').value
        };
        
        // Debug: Log the data being sent
        console.log('Sending appointment data:', formData);
        console.log('Guest checkbox checked:', document.getElementById('is-guest').checked);
        console.log('is_guest value:', formData.is_guest);
        
        // Send to Django backend
        const response = await fetch('http://localhost:8080/api/book-appointment/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        // Debug: Log the response
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        let result;
        try {
            result = await response.json();
        } catch (error) {
            console.error('Failed to parse response:', error);
            showNotification('Server error: Invalid response format', 'error');
            return;
        }
        
        if (response.ok) {
            // Show appropriate success message
            if (result.is_guest && result.guest_id) {
                showNotification(`Guest appointment booked successfully! Your Guest ID is: ${result.guest_id}. Check your email for confirmation.`, 'success');
            } else {
                showNotification('Appointment booked successfully! Check your email for confirmation.', 'success');
            }
            
            // Store appointment in localStorage for dashboard access
            const appointmentData = {
                id: result.id || result.appointment_id || 'apt-' + Date.now(),
                guest_id: result.guest_id || null,
                is_guest: result.is_guest || false,
                user: {
                    id: localStorage.getItem('userId') || (result.is_guest ? 'guest' : 'user'),
                    first_name: formData.firstname,
                    last_name: formData.lastname,
                    email: formData.email,
                    phone: formData.phone
                },
                date: formData.appointment_date + 'T' + formData.appointment_time + ':00Z',
                service_type: formData.service_type,
                status: 'scheduled',
                symptoms: formData.symptoms,
                medical_history: formData.medical_history,
                previous_treatment: formData.previous_treatment,
                special_requirements: formData.special_requirements,
                insurance: formData.insurance,
                urgency: formData.urgency,
                referral: formData.referral,
                created_at: new Date().toISOString()
            };
            
            // Get existing appointments or create new array
            const existingAppointments = localStorage.getItem('userAppointments');
            let userAppointments = [];
            if (existingAppointments) {
                try {
                    userAppointments = JSON.parse(existingAppointments);
                } catch (e) {
                    console.warn('Failed to parse existing appointments, starting fresh');
                }
            }
            
            // Add new appointment
            userAppointments.push(appointmentData);
            
            // Store updated appointments
            localStorage.setItem('userAppointments', JSON.stringify(userAppointments));
            console.log('✅ Appointment stored in localStorage:', appointmentData);
            
            // Show success details
            showAppointmentConfirmation(result);
            
            // Reset form
            document.querySelector('.booking-form').reset();
            
        } else {
            // Debug: Log the full error response
            console.log('Error response:', result);
            
            let errorMessage = 'Booking failed. Please try again.';
            if (result.error) {
                errorMessage = result.error;
            } else if (result.detail) {
                errorMessage = result.detail;
            } else if (result.non_field_errors) {
                errorMessage = result.non_field_errors.join(', ');
            } else if (typeof result === 'object') {
                // Handle field-specific errors
                const fieldErrors = Object.entries(result)
                    .filter(([key, value]) => Array.isArray(value) && value.length > 0)
                    .map(([key, value]) => `${key}: {value.join(', ')}`);
                if (fieldErrors.length > 0) {
                    errorMessage = fieldErrors.join('; ');
                }
            }
            
            showNotification(`Booking failed: ${errorMessage}`, 'error');
        }
        
    } catch (error) {
        console.error('Error submitting appointment:', error);
        showNotification('Failed to book appointment. Please check your connection and try again.', 'error');
    } finally {
        // Reset button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
}

// Show appointment confirmation modal with treatment plan options
function showAppointmentConfirmation(result) {
    const modal = document.createElement('div');
    modal.className = 'confirmation-modal';
    
    // Check if user is a therapist to show treatment plan options
    const isTherapist = checkIfUserIsTherapist();
    
    modal.innerHTML = `
        <div class="confirmation-content">
            <div class="confirmation-header">
                <i class="fas fa-check-circle success-icon"></i>
                <h2>Appointment Confirmed!</h2>
            </div>
            <div class="confirmation-body">
                <p><strong>Appointment ID:</strong> #${result.appointment_id || result.id}</p>
                <p><strong>Date & Time:</strong> ${result.appointment_date || 'Scheduled'}</p>
                <p><strong>Service:</strong> ${result.service_type || 'Consultation'}</p>
                <p><strong>Status:</strong> Scheduled</p>
                <p>A confirmation email has been sent to your email address.</p>
                
                ${isTherapist ? `
                <div class="treatment-plan-section" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
                    <h4 style="margin: 0 0 10px 0; color: #28a745;">
                        <i class="fas fa-clipboard-list"></i> Next Step: Create Treatment Plan
                    </h4>
                    <p style="margin: 0 0 15px 0; color: #666;">
                        Now that the appointment is booked, you can create a comprehensive treatment plan for this patient.
                    </p>
                    <div class="treatment-plan-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="createTreatmentPlanNow('${result.appointment_id || result.id}')" class="btn-primary" style="background: #28a745; border: none; padding: 10px 20px; border-radius: 5px; color: white; cursor: pointer;">
                            <i class="fas fa-plus"></i> Create Treatment Plan Now
                        </button>
                        <button onclick="createTreatmentPlanLater('${result.appointment_id || result.id}')" class="btn-secondary" style="background: #6c757d; border: none; padding: 10px 20px; border-radius: 5px; color: white; cursor: pointer;">
                            <i class="fas fa-clock"></i> Create Later
                        </button>
                    </div>
                </div>
                ` : `
                <div class="patient-info-section" style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
                    <h4 style="margin: 0 0 10px 0; color: #2196f3;">
                        <i class="fas fa-info-circle"></i> What Happens Next?
                    </h4>
                    <p style="margin: 0 0 15px 0; color: #666;">
                        Your therapist will review your appointment details and create a personalized treatment plan. 
                        You'll receive updates about your treatment plan and can track your progress.
                    </p>
                    <button onclick="viewPatientDashboard()" class="btn-primary" style="background: #2196f3; border: none; padding: 10px 20px; border-radius: 5px; color: white; cursor: pointer;">
                        <i class="fas fa-user"></i> Go to Patient Dashboard
                    </button>
                </div>
                `}
            </div>
            <div class="confirmation-footer">
                <button onclick="this.closest('.confirmation-modal').remove()" class="btn-primary">Close</button>
                ${isTherapist ? `
                <button onclick="viewAllAppointments()" class="btn-secondary" style="background: #6c757d; border: none; padding: 10px 20px; border-radius: 5px; color: white; cursor: pointer; margin-left: 10px;">
                    <i class="fas fa-calendar"></i> View All Appointments
                </button>
                ` : ''}
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Auto-remove after 15 seconds (increased for better UX)
    setTimeout(() => {
        if (modal.parentNode) {
            modal.remove();
        }
    }, 15000);
}

// Check if current user is a therapist
function checkIfUserIsTherapist() {
    const userRole = localStorage.getItem('userRole');
    return userRole === 'therapist';
}

// Create treatment plan immediately after appointment booking
async function createTreatmentPlanNow(appointmentId) {
    try {
        // Store appointment ID for treatment plan creation
        localStorage.setItem('pendingTreatmentPlanAppointment', appointmentId);
        
        // Close the confirmation modal
        const modal = document.querySelector('.confirmation-modal');
        if (modal) {
            modal.remove();
        }
        
        // Show notification
        showNotification('Redirecting to treatment plan creation...', 'info');
        
        // Redirect to treatment plan creation page with pre-filled appointment
        setTimeout(() => {
            window.location.href = '../create-treatment-plan.html?appointment=' + appointmentId;
        }, 1500);
        
    } catch (error) {
        console.error('Error redirecting to treatment plan creation:', error);
        showNotification('Error redirecting to treatment plan creation. Please navigate manually.', 'error');
    }
}

// Create treatment plan later (store appointment ID for later use)
function createTreatmentPlanLater(appointmentId) {
    try {
        // Store appointment ID for later treatment plan creation
        localStorage.setItem('pendingTreatmentPlanAppointment', appointmentId);
        
        // Show notification
        showNotification('Appointment ID saved for later treatment plan creation.', 'success');
        
        // Close the confirmation modal
        const modal = document.querySelector('.confirmation-modal');
        if (modal) {
            modal.remove();
        }
        
    } catch (error) {
        console.error('Error saving appointment ID:', error);
        showNotification('Error saving appointment ID for later use.', 'error');
    }
}

// Navigate to patient dashboard
function viewPatientDashboard() {
    try {
        window.location.href = '../patient-dashboard.html';
    } catch (error) {
        console.error('Error navigating to patient dashboard:', error);
        showNotification('Error navigating to dashboard. Please navigate manually.', 'error');
    }
}



// Navigate to view all appointments (for therapists)
function viewAllAppointments() {
    try {
        window.location.href = '../admin-appointments.html';
    } catch (error) {
        console.error('Error navigating to appointments:', error);
        showNotification('Error navigating to appointments. Please navigate manually.', 'error');
    }
}

// Notification system
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="notification-close">&times;</button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
}

// Set minimum date to today
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('appointment-date').min = today;
    
    // Auto-populate time slots based on selected date
    document.getElementById('appointment-date').addEventListener('change', function() {
        const selectedDate = new Date(this.value);
        const dayOfWeek = selectedDate.getDay();
        
        // Disable weekends (0 = Sunday, 6 = Saturday)
        if (dayOfWeek === 0 || dayOfWeek === 6) {
            alert('Appointments are not available on weekends. Please select a weekday.');
            this.value = '';
        }
    });
});

// Real-time form validation
document.querySelectorAll('input, select, textarea').forEach(field => {
    field.addEventListener('blur', function() {
        if (this.hasAttribute('required') && !this.value.trim()) {
            this.style.borderColor = '#e74c3c';
        } else {
            this.style.borderColor = '';
        }
    });
    
    field.addEventListener('input', function() {
        if (this.style.borderColor === 'rgb(231, 76, 60)') {
            this.style.borderColor = '';
        }
    });
});
</script>



</body>
</html>
